# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

EnumMap:
  AggregationNode:
    Step: AggregationNodeStep

  ExchangeNode:
    Type: ExchangeNodeType
    Scope: ExchangeNodeScope

  LimitNode:
    Step: LimitNodeStep

  SelectedRole:
    Type: SelectedRoleType

  SampleNode:
    Type: SampleNodeType

ExtraFields:
  RowExpression:
    std::shared_ptr<SourceLocation>: sourceLocation

  Aggregation:
    FunctionHandle:      functionHandle
    List<RowExpression>: arguments

  PlanNode:
    PlanNodeId:          id

  RemoteTransactionHandle:
    Optional<String>:    dummy

AddToOutput:
  - NodeState

AbstractClasses:
  ColumnHandle:
    super: JsonEncodedSubclass
    comparable: true
    subclasses:
      - { name: IcebergColumnHandle,      key: hive-iceberg }

  ConnectorPartitioningHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: HivePartitioningHandle,   key: hive}

  ConnectorTableHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: IcebergTableHandle,       key: hive-iceberg }

  ConnectorOutputTableHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: IcebergOutputTableHandle,       key: hive-iceberg }

  ConnectorInsertTableHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: IcebergInsertTableHandle,       key: hive-iceberg }

  ConnectorTableLayoutHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: IcebergTableLayoutHandle, key: hive-iceberg }

  ConnectorMetadataUpdateHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: HiveMetadataUpdateHandle, key: hive}

  ConnectorSplit:
    super: JsonEncodedSubclass
    subclasses:
      - { name: IcebergSplit,         key: hive-iceberg }

  ConnectorHistogram:
    super: JsonEncodedSubclass
    subclasses:
      - { name: UniformDistributionHistogram, key: uniform-distribution}

  ExecutionWriterTarget:
    super: JsonEncodedSubclass
    subclasses:
      - { name: CreateHandle,            key: CreateHandle }
      - { name: InsertHandle,            key: InsertHandle }
      - { name: DeleteHandle,            key: DeleteHandle }

  PlanNode:
    super: JsonEncodedSubclass
    subclasses:
      - { name: AggregationNode,          key: .AggregationNode }
      - { name: GroupIdNode,              key: com.facebook.presto.sql.planner.plan.GroupIdNode }
      - { name: DistinctLimitNode,        key: .DistinctLimitNode }
      - { name: EnforceSingleRowNode,     key: com.facebook.presto.sql.planner.plan.EnforceSingleRowNode }
      - { name: ExchangeNode,             key: com.facebook.presto.sql.planner.plan.ExchangeNode }
      - { name: FilterNode,               key: .FilterNode }
      - { name: JoinNode,                 key: com.facebook.presto.sql.planner.plan.JoinNode }
      - { name: LimitNode,                key: .LimitNode }
      - { name: MarkDistinctNode,         key: .MarkDistinctNode }
      - { name: SortNode,                 key: .SortNode }
      - { name: OutputNode,               key: .OutputNode }
      - { name: ProjectNode,              key: .ProjectNode }
      - { name: RowNumberNode,            key: com.facebook.presto.sql.planner.plan.RowNumberNode }
      - { name: RemoteSourceNode,         key: com.facebook.presto.sql.planner.plan.RemoteSourceNode }
      - { name: SampleNode,               key: com.facebook.presto.sql.planner.plan.SampleNode }
      - { name: SemiJoinNode,             key: com.facebook.presto.sql.planner.plan.SemiJoinNode }
      - { name: TableScanNode,            key: .TableScanNode }
      - { name: TableWriterNode,          key: com.facebook.presto.sql.planner.plan.TableWriterNode }
      - { name: TableWriterMergeNode,     key: com.facebook.presto.sql.planner.plan.TableWriterMergeNode }
      - { name: TopNNode,                 key: .TopNNode }
      - { name: TopNRowNumberNode,        key: com.facebook.presto.sql.planner.plan.TopNRowNumberNode }
      - { name: UnnestNode,               key: com.facebook.presto.sql.planner.plan.UnnestNode }
      - { name: ValuesNode,               key: .ValuesNode }
      - { name: AssignUniqueId,           key: com.facebook.presto.sql.planner.plan.AssignUniqueId }
      - { name: MergeJoinNode,            key: com.facebook.presto.sql.planner.plan.MergeJoinNode }
      - { name: WindowNode,               key: com.facebook.presto.sql.planner.plan.WindowNode }

  RowExpression:
    super: JsonEncodedSubclass
    subclasses:
      - { name: CallExpression,             key: call }
      - { name: ConstantExpression,         key: constant }
      - { name: SpecialFormExpression,      key: special }
      - { name: LambdaDefinitionExpression, key: lambda }
      - { name: VariableReferenceExpression,key: variable }

  ValueSet:
    super: JsonEncodedSubclass
    subclasses:
      - { name: EquatableValueSet,          key: equatable }
      - { name: SortedRangeSet,             key: sortable }
      - { name: AllOrNoneValueSet,          key: allOrNone }

  FunctionHandle:
    super: JsonEncodedSubclass
    subclasses:
      - { name: BuiltInFunctionHandle,      key: $static }
      - { name: SqlFunctionHandle,          key: json_file }

JavaClasses:
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/FileContent.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/FileFormat.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/PrestoIcebergSchema.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergSplit.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergTableHandle.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergTableName.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergTableType.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergTableLayoutHandle.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergOutputTableHandle.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergInsertTableHandle.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/IcebergColumnHandle.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/ColumnIdentity.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/PrestoIcebergPartitionSpec.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/PrestoIcebergNestedField.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/delete/DeleteFile.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/changelog/ChangelogOperation.java
  - presto-iceberg/src/main/java/com/facebook/presto/iceberg/changelog/ChangelogSplitInfo.java